substitutions:
    name: m5-r2
packages:
    device: !include ../packages/device-d1mini.yaml
    networking: !include ../packages/networking.yaml
esphome:
    on_boot:
        - priority: 800
          then:
            - switch.turn_off: straight_relay_sw2
            - switch.turn_off: off_relay_sw2
            - switch.turn_off: out_a_in_a_l4inverter
            - switch.turn_off: out_a_in_b_l4inverter
            - switch.turn_off: out_b_in_a_l4inverter
            - switch.turn_off: out_b_in_b_l4inverter
        - priority: 600
          then:
            - switch.turn_on: led_yellow
            - switch.turn_on: led_green
            - switch.turn_on: led_red
            - delay: 2s
            - switch.turn_off: led_yellow
            - switch.turn_off: led_green
            - switch.turn_off: led_red
logger:
    level: DEBUG
mqtt:
    on_connect:
        - switch.turn_on: led_green
    on_disconnect:
        - switch.turn_off: led_green
    topic_prefix: /binky/m5-r2/info
ota:
    platform: esphome
web_server:
    port: 80
    local: true
wifi:
    fast_connect: true
    domain: .tzl
    on_connect:
        - switch.turn_on: led_yellow
    on_disconnect:
        - switch.turn_off: led_yellow
binary_sensor:
    - platform: gpio
      id: ios2_pin1
      name: ios2_pin1
      state_topic: /binky/m5/ios2_pin1/sensor/state
      pin:
        number: "0"
        mcp23xxx: ios2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: ios2_pin2
      name: ios2_pin2
      state_topic: /binky/m5/ios2_pin2/sensor/state
      pin:
        number: "1"
        mcp23xxx: ios2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: ios2_pin3
      name: ios2_pin3
      state_topic: /binky/m5/ios2_pin3/sensor/state
      pin:
        number: "2"
        mcp23xxx: ios2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: ios2_pin4
      name: ios2_pin4
      state_topic: /binky/m5/ios2_pin4/sensor/state
      pin:
        number: "3"
        mcp23xxx: ios2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: ios2_pin5
      name: ios2_pin5
      state_topic: /binky/m5/ios2_pin5/sensor/state
      pin:
        number: "4"
        mcp23xxx: ios2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: ios2_pin6
      name: ios2_pin6
      state_topic: /binky/m5/ios2_pin6/sensor/state
      pin:
        number: "5"
        mcp23xxx: ios2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: ios2_pin7
      name: ios2_pin7
      state_topic: /binky/m5/ios2_pin7/sensor/state
      pin:
        number: "6"
        mcp23xxx: ios2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: ios2_pin8
      name: ios2_pin8
      state_topic: /binky/m5/ios2_pin8/sensor/state
      pin:
        number: "7"
        mcp23xxx: ios2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: io2_pin1
      name: io2_pin1
      state_topic: /binky/m5/io2_pin1/sensor/state
      pin:
        number: "0"
        mcp23xxx: io2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: io2_pin2
      name: io2_pin2
      state_topic: /binky/m5/io2_pin2/sensor/state
      pin:
        number: "1"
        mcp23xxx: io2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: io2_pin3
      name: io2_pin3
      state_topic: /binky/m5/io2_pin3/sensor/state
      pin:
        number: "2"
        mcp23xxx: io2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: io2_pin4
      name: io2_pin4
      state_topic: /binky/m5/io2_pin4/sensor/state
      pin:
        number: "3"
        mcp23xxx: io2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: io2_pin5
      name: io2_pin5
      state_topic: /binky/m5/io2_pin5/sensor/state
      pin:
        number: "4"
        mcp23xxx: io2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: io2_pin6
      name: io2_pin6
      state_topic: /binky/m5/io2_pin6/sensor/state
      pin:
        number: "5"
        mcp23xxx: io2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: io2_pin7
      name: io2_pin7
      state_topic: /binky/m5/io2_pin7/sensor/state
      pin:
        number: "6"
        mcp23xxx: io2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: io2_pin8
      name: io2_pin8
      state_topic: /binky/m5/io2_pin8/sensor/state
      pin:
        number: "7"
        mcp23xxx: io2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: iotiny2_pin1
      name: iotiny2_pin1
      state_topic: /binky/m5/iotiny2_pin1/sensor/state
      pin:
        number: "0"
        pcf8574: iotiny2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: iotiny2_pin2
      name: iotiny2_pin2
      state_topic: /binky/m5/iotiny2_pin2/sensor/state
      pin:
        number: "1"
        pcf8574: iotiny2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: iotiny2_pin3
      name: iotiny2_pin3
      state_topic: /binky/m5/iotiny2_pin3/sensor/state
      pin:
        number: "2"
        pcf8574: iotiny2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: iotiny2_pin4
      name: iotiny2_pin4
      state_topic: /binky/m5/iotiny2_pin4/sensor/state
      pin:
        number: "3"
        pcf8574: iotiny2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: iotiny2_pin5
      name: iotiny2_pin5
      state_topic: /binky/m5/iotiny2_pin5/sensor/state
      pin:
        number: "4"
        pcf8574: iotiny2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: iotiny2_pin6
      name: iotiny2_pin6
      state_topic: /binky/m5/iotiny2_pin6/sensor/state
      pin:
        number: "5"
        pcf8574: iotiny2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: iotiny2_pin7
      name: iotiny2_pin7
      state_topic: /binky/m5/iotiny2_pin7/sensor/state
      pin:
        number: "6"
        pcf8574: iotiny2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: iotiny2_pin8
      name: iotiny2_pin8
      state_topic: /binky/m5/iotiny2_pin8/sensor/state
      pin:
        number: "7"
        pcf8574: iotiny2
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: iotiny3_pin1
      name: iotiny3_pin1
      state_topic: /binky/m5/iotiny3_pin1/sensor/state
      pin:
        number: "0"
        pcf8574: iotiny3
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: iotiny3_pin2
      name: iotiny3_pin2
      state_topic: /binky/m5/iotiny3_pin2/sensor/state
      pin:
        number: "1"
        pcf8574: iotiny3
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: iotiny3_pin3
      name: iotiny3_pin3
      state_topic: /binky/m5/iotiny3_pin3/sensor/state
      pin:
        number: "2"
        pcf8574: iotiny3
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: iotiny3_pin4
      name: iotiny3_pin4
      state_topic: /binky/m5/iotiny3_pin4/sensor/state
      pin:
        number: "3"
        pcf8574: iotiny3
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: iotiny3_pin5
      name: iotiny3_pin5
      state_topic: /binky/m5/iotiny3_pin5/sensor/state
      pin:
        number: "4"
        pcf8574: iotiny3
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: iotiny3_pin6
      name: iotiny3_pin6
      state_topic: /binky/m5/iotiny3_pin6/sensor/state
      pin:
        number: "5"
        pcf8574: iotiny3
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: iotiny3_pin7
      name: iotiny3_pin7
      state_topic: /binky/m5/iotiny3_pin7/sensor/state
      pin:
        number: "6"
        pcf8574: iotiny3
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
    - platform: gpio
      id: iotiny3_pin8
      name: iotiny3_pin8
      state_topic: /binky/m5/iotiny3_pin8/sensor/state
      pin:
        number: "7"
        pcf8574: iotiny3
        mode:
            input: true
      on_state:
        then:
            - switch.turn_on: led_red
            - delay: 0.2s
            - switch.turn_off: led_red
button:
    - platform: restart
      id: reboot
      name: reboot
sensor:
    - platform: uptime
      id: uptime_sensor
      name: uptime_sensor
      state_topic: /binky/m5-r2/info/uptime
      update_interval: 15s
    - platform: wifi_signal
      id: wifi_signal_sensor
      name: wifi_signal_sensor
      state_topic: /binky/m5-r2/info/wifi_signal
switch:
    - platform: gpio
      id: led_red
      name: led_red
      pin:
        number: D5
        inverted: true
    - platform: gpio
      id: led_yellow
      name: led_yellow
      pin:
        number: D6
        inverted: true
    - platform: gpio
      id: led_green
      name: led_green
      pin:
        number: D7
        inverted: true
    - platform: gpio
      id: straight_relay_sw2
      name: straight_relay_sw2
      state_topic: /binky/m5/sw2/phase-straight-relay/state
      command_topic: /binky/m5/sw2/phase-straight-relay/command
      pin:
        number: "8"
        mcp23xxx: io2
        mode:
            output: true
    - platform: gpio
      id: off_relay_sw2
      name: off_relay_sw2
      state_topic: /binky/m5/sw2/phase-off-relay/state
      command_topic: /binky/m5/sw2/phase-off-relay/command
      pin:
        number: "9"
        mcp23xxx: io2
        mode:
            output: true
    - platform: gpio
      id: out_a_in_a_l4inverter
      name: out_a_in_a_l4inverter
      state_topic: /binky/GLOBAL/l4inverter/relay-out-a-in-a/state
      command_topic: /binky/GLOBAL/l4inverter/relay-out-a-in-a/command
      pin:
        number: "12"
        mcp23xxx: io2
        mode:
            output: true
    - platform: gpio
      id: out_a_in_b_l4inverter
      name: out_a_in_b_l4inverter
      state_topic: /binky/GLOBAL/l4inverter/relay-out-a-in-b/state
      command_topic: /binky/GLOBAL/l4inverter/relay-out-a-in-b/command
      pin:
        number: "13"
        mcp23xxx: io2
        mode:
            output: true
    - platform: gpio
      id: out_b_in_a_l4inverter
      name: out_b_in_a_l4inverter
      state_topic: /binky/GLOBAL/l4inverter/relay-out-b-in-a/state
      command_topic: /binky/GLOBAL/l4inverter/relay-out-b-in-a/command
      pin:
        number: "14"
        mcp23xxx: io2
        mode:
            output: true
    - platform: gpio
      id: out_b_in_b_l4inverter
      name: out_b_in_b_l4inverter
      state_topic: /binky/GLOBAL/l4inverter/relay-out-b-in-b/state
      command_topic: /binky/GLOBAL/l4inverter/relay-out-b-in-b/command
      pin:
        number: "15"
        mcp23xxx: io2
        mode:
            output: true
text_sensor:
    - platform: wifi_info
      ip_address:
        name: ip_address
        state_topic: /binky/m5-r2/info/ip_address
i2c: {}
mcp23008:
    - id: ios2
      address: "0x22"
mcp23017:
    - id: io2
      address: "0x25"
pcf8574:
    - id: iotiny2
      address: "0x23"
    - id: iotiny3
      address: "0x24"
